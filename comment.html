<!DOCTYPE html>
<html lang="en">
<head>
  <title>Food Comment</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo">Food Ninja</a>
      <div class="nav-links">
        <a href="index.html">Blog</a>
        <a href="#">About</a>
        <a href="#">Contact</a>
      </div>
    </div>
  </nav>

  <main>
    <h1 class="title">Comments</h1>
    <div class="comments">
      
      <div class="comment">
        <p class="name">Elif****</p>
        <p>I agree with that comment.</p>
        <div class="comment-box">
          <input type="text" class="reply-input" placeholder="Enter your comment">
          <button class="reply-btn">Reply</button>
        </div>
      </div>

      <div class="comment">
        <p class="name">Göksu****</p>
        <p>I agree with that comment.</p>
        <div class="comment-box">
          <input type="text" class="reply-input" placeholder="Enter your comment">
          <button class="reply-btn">Reply</button>
        </div>
      </div>

      <div class="comment">
        <p class="name">Defne****</p>
        <p>I agree with that comment.</p>
        <div class="comment-box">
          <input type="text" class="reply-input" placeholder="Enter your comment">
          <button class="reply-btn">Reply</button>
        </div>
      </div>
    </div>

    <div id="your-comment">
      <input type="text" id="mainInput" placeholder="Write a new comment...">
    </div>
    <button id="enterBtn">Enter</button>
  </main>

  <div class="footer-container">
    <div class="texts"><p>About</p><p>Privacy Policy</p><p>Contact</p></div>
    <p style="padding-bottom: 30px; text-align: center;"><b>Copyright © 2021 Food Ninja Blog. All Rights Reserved.</b></p>
  </div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        loadComments();
    });

    function createCommentElement(text, isReply) {
        const commentDiv = document.createElement("div");
        

        commentDiv.className = isReply ? "comment dynamic-comment nested-reply" : "comment dynamic-comment"; 
        
        if(isReply) {
            commentDiv.style.marginLeft = "40px"; 
            commentDiv.style.borderLeft = "4px solid #1e3a8a"; 
            commentDiv.style.backgroundColor = "#f9f9f9";
            commentDiv.style.height = "auto"; 
            commentDiv.style.padding = "15px";
            commentDiv.style.marginTop = "10px";
        }

        commentDiv.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <p class="name">You**** ${isReply ? '(Reply)' : ''}</p>
                <button class="delete-btn" style="background:red; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">Delete</button>
            </div>
            <p class="comment-text">${text}</p>
            
            <div class="comment-box">
                <input type="text" class="reply-input" placeholder="Yanıt yaz...">
                <button class="reply-btn">Reply</button>
            </div>
            <div class="replies-container"></div>
        `;

        const deleteButton = commentDiv.querySelector(".delete-btn");
        deleteButton.addEventListener("click", function (e) {
            e.stopPropagation(); 
            commentDiv.remove();
            saveCommentsToStorage(); 
        });

        const replyButton = commentDiv.querySelector(".reply-btn");
        const replyInput = commentDiv.querySelector(".reply-input");
        const repliesContainer = commentDiv.querySelector(".replies-container");

        replyButton.addEventListener("click", function(e) {
            e.stopPropagation();
            const replyText = replyInput.value.trim();
            if (replyText === "") return;

            const newReply = createCommentElement(replyText, true);
            
            repliesContainer.appendChild(newReply);

            saveCommentsToStorage(); 
            replyInput.value = "";
        });

        return commentDiv;
    }

    document.getElementById("enterBtn").addEventListener("click", function() {
        const input = document.getElementById("mainInput");
        const text = input.value.trim();

        if (text === "") return;

        const newComment = createCommentElement(text, false); 
        document.querySelector(".comments").appendChild(newComment);
        
        saveCommentsToStorage();
        input.value = "";
    });

    const staticReplyButtons = document.querySelectorAll(".comments > .comment:not(.dynamic-comment) .reply-btn");

    staticReplyButtons.forEach(btn => {
        btn.addEventListener("click", function() {
            const input = this.previousElementSibling;
            const text = input.value.trim();
            if (text === "") return;

            const newReply = createCommentElement(text, true);
            
            const parentComment = this.closest(".comment");
            parentComment.appendChild(newReply);

            input.value = "";
        });
    });


    function saveCommentsToStorage() {
        const commentsData = [];
        
        const topLevelComments = document.querySelectorAll(".comments > .dynamic-comment");

        topLevelComments.forEach(commentEl => {
            const text = commentEl.querySelector(".comment-text").innerText;
            
            const repliesData = [];
            const repliesContainer = commentEl.querySelector(".replies-container");
            
            if (repliesContainer) {
                const nestedReplies = repliesContainer.querySelectorAll(".nested-reply");
                nestedReplies.forEach(replyEl => {
                     const replyText = replyEl.querySelector(".comment-text").innerText;
                     repliesData.push(replyText);
                });
            }

            commentsData.push({
                text: text,
                replies: repliesData
            });
        });

        localStorage.setItem("foodBlogComplexData", JSON.stringify(commentsData));
    }

    function loadComments() {
        const storedData = JSON.parse(localStorage.getItem("foodBlogComplexData")) || [];

        storedData.forEach(data => {
            const mainCommentEl = createCommentElement(data.text, false);
            
            if (data.replies && data.replies.length > 0) {
                const container = mainCommentEl.querySelector(".replies-container");
                data.replies.forEach(replyText => {
                    const replyEl = createCommentElement(replyText, true);
                    container.appendChild(replyEl);
                });
            }

            document.querySelector(".comments").appendChild(mainCommentEl);
        });
    }

</script>
</body>
</html>

